# 周易预测系统 - 项目说明

## "周易预测"融合入"时间序列"的尝试

经过了几次尝试把“周易预测”融合入“时间序列”里，以下是所得成绩：

第一次成功尝试，成绩刚刚达100分：
100.3638 资金流入流出预测GPU_V2.py (tc_comp_predict_table_GPU_V2.csv)

第二次成功尝试，成绩达120分：
120.3101 cycle_factor_analysis_iching.py (iching_enhanced_predictions.csv)

以下是我在 GitHub 的代码分享，希望同学们能够继续从代码中获得灵感，持续优化，让中华数术登上科学的殿堂。

周易预测与时间序列
https://github.com/XonLoke/-YiJing-Time-Analysis

#蚂蚁金服资金流入流出预测比赛
https://tianchi.aliyun.com/competition/entrance/231573

官方提供的文件在 Purchase Redemption Data.zip 里：
https://tianchi.aliyun.com/competition/entrance/231573/information
   - comp_predict_table.csv
   - mfd_bank_shibor.csv
   - mfd_day_share_interest.csv
   - user_balance_table.csv
   - user_profile_table.csv

## 项目背景
蚂蚁金服拥有上亿会员，每天涉及大量资金流入和流出。需要精准预测未来每日的资金流入流出情况，以保证资金流动性风险最小，同时满足日常业务运转。

## 数据概述
### 数据文件说明
1. **用户信息表** (`user_profile_table.csv`)
   - 约2.8万用户基本信息
   - 字段：user_id, sex, city, constellation

2. **用户申购赎回数据表** (`user_balance_table.csv`)
   - 时间范围：2013年7月1日至2014年8月31日
   - 包含用户每日申购、赎回、余额等详细信息
   - 关键字段：total_purchase_amt（申购总额）、total_redeem_amt（赎回总额）

3. **收益率表** (`mfd_day_share_interest.csv`)
   - 余额宝14个月内的收益率数据
   - 字段：mfd_date, mfd_daily_yield（万份收益）, mfd_7daily_yield（七日年化收益率）

4. **银行间拆借利率表** (`mfd_bank_shibor.csv`)
   - 14个月期间银行间拆借利率数据
   - 包含隔夜、1周、2周、1月、3月  6月、9月、1年等不同期限利率

### 预测目标
预测2014年9月1日至9月30日每天的：
- 申购总额（purchase）
- 赎回总额（redeem）
预测结果生成格式示例：`comp_predict_table.csv`
（不含表头）

-------------

# 易卦增强资金流预测模型说明

## 模型概述

本模型将传统易卦理论与现代机器学习技术相结合，用于预测资金流入流出。通过将金融数据映射到八卦系统，提取隐含的周期性和趋势性特征，提升预测准确性。

## 易卦理论基础

### 八卦映射规则
根据变量数除以8的余数确定卦象：
- 余数0 = 坤卦（平和，全虚，老母）
- 余数1 = 乾卦（平和，全实，老父）
- 余数2 = 兑卦（下降，上虚，小女）
- 余数3 = 离卦（上升，中虚，中女）
- 余数4 = 震卦（上升，下实，长子）
- 余数5 = 巽卦（下降，下虚，大女）
- 余数6 = 坎卦（下降，中实，中男）
- 余数7 = 艮卦（上升，上实，小儿）

### 卦气趋势
- 乾卦、坤卦：平和（趋势值0）
- 离卦、震卦、艮卦：上升（趋势值+1）
- 兑卦、巽卦、坎卦：下降（趋势值-1）

### 变量数定义
- **x变量数（下卦）**：申购金额/1e6，代表内在资金需求
- **y变量数（上卦）**：日期+月份*10+年份，代表外在市场环境
- **z变量数（变爻）**：赎回金额/1e5+日*月，代表变化动力

### 变爻计算
z除以6的余数决定变爻位置：
- 余数1-3：影响下卦（1=最下爻，2=中爻，3=最上爻）
- 余数4-6：影响上卦（4=最下爻，5=中爻，6=最上爻）
- 余数0：等于6号变爻（上卦最上爻）

## 模型架构

### 三层融合模型
1. **基础模型**：线性回归 + 周期因子（星期、月内日期）
2. **易卦增强模型**：基础特征 + 9个易卦特征
3. **残差修正模型**：随机森林修正预测残差

### 易卦特征工程
生成9个易卦特征：
- original_lower_trend：原卦下卦趋势
- original_upper_trend：原卦上卦趋势
- changed_lower_trend：变卦下卦趋势
- changed_upper_trend：变卦上卦趋势
- changing_line：变爻位置（1-6）
- lower_yang：下卦阴阳属性（0=阴，1=阳）
- upper_yang：上卦阴阳属性（0=阴，1=阳）
- original_combined_trend：原卦综合趋势
- changed_combined_trend：变卦综合趋势

## 模型性能

### 训练结果对比
| 模型类型 | 申购MAE | 赎回MAE | 申购R² | 赎回R² |
|---------|---------|---------|--------|--------|
| 基础模型 | 46,417,341 | 54,743,736 | 0.4989 | 0.4165 |
| 易卦增强 | 45,982,578 | 54,328,668 | 0.5099 | 0.4279 |
| 最终融合 | 19,555,387 | 23,785,703 | - | - |

### 性能提升
- 申购预测MAE降低57.8%（从46M到19.6M）
- 赎回预测MAE降低56.5%（从54.7M到23.8M）
- R²分数均有提升，模型解释能力增强

## 2014年9月预测结果

### 预测统计
- 申购金额预测范围：151,778,201 - 387,465,326
- 申购金额预测平均：277,791,198
- 赎回金额预测范围：171,303,767 - 387,776,485
- 赎回金额预测平均：279,689,830

### 关键日期易卦分析

#### 2014-09-08（周一）
- 原卦：艮(下) + 坤(上) - 上升趋势
- 变卦：离(下) + 坤(上) - 上升趋势
- 变爻：3爻（下卦最上爻）
- 建议：平稳卦象，适合保守策略

#### 2014-09-15（周一）
- 原卦：坤(下) + 艮(上) - 上升趋势
- 变卦：坤(下) + 艮(上) - 上升趋势
- 变爻：4爻（上卦最下爻）
- 建议：平稳卦象，适合保守策略

#### 2014-09-22（周一）
- 原卦：离(下) + 坎(上) - 平稳趋势
- 变卦：震(下) + 坎(上) - 平稳趋势
- 变爻：1爻（下卦最下爻）
- 建议：关键变爻，注意趋势转折

#### 2014-09-30（周二）
- 原卦：离(下) + 坎(上) - 平稳趋势
- 变卦：乾(下) + 坎(上) - 下降趋势
- 变爻：2爻（下卦中爻）
- 建议：卦气发生变化，关注市场动向

## 技术创新点

1. **传统文化与现代AI融合**：将易卦理论数字化，提取非线性特征
2. **多层次特征工程**：原卦、变卦、变爻三重信息提取
3. **残差修正机制**：随机森林捕捉复杂非线性关系
4. **可解释性增强**：每个预测都有对应的卦象解释

## 应用价值

1. **预测精度提升**：相比基础模型，MAE降低超过50%
2. **风险识别**：通过变爻分析识别趋势转折点
3. **决策支持**：提供基于传统智慧的投资建议
4. **文化传承**：将古代智慧应用于现代金融科技

## 文件输出

1. `iching_enhanced_predictions.csv`：标准格式预测结果
2. `iching_detailed_predictions.csv`：详细预测结果（含周期因子）
3. `iching_enhanced_predictions_plot.png`：预测可视化图表
4. `cycle_factor_analysis_iching.py`：完整源代码

## 使用说明

运行命令：
```bash
python cycle_factor_analysis_iching.py
```

模型会自动：
1. 加载历史数据（2014年3-8月）
2. 生成易卦特征
3. 训练三层融合模型
4. 预测9月资金流向
5. 输出易卦解释和建议

## 未来改进方向

1. **更多易卦要素**：加入五行、天干地支等传统要素
2. **动态权重调整**：根据市场状态调整易卦特征权重
3. **多时间尺度**：扩展到周、月、季度级别预测
4. **实时更新**：结合实时数据动态调整卦象解释
